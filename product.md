# 产品待办事项（screen-recording-tool）

更新时间：2025-08-31

## 背景
面向 Windows 的轻量屏幕录制与基础编辑（裁剪/转码）工具。当前已具备屏幕/窗口录制、分辨率选择、可选系统音频、时间/区域裁剪、H.264 转码与下载等能力。

## 目标
- 降低录制失败率，提升长时间录制的稳定性与兼容性；
- 强化安全基线，适配新版 Electron；
- 优化导出体验与资源占用；
- 增强基础编辑与音频选项。

## 优先级说明
- P0：必须优先，影响安全/数据可靠性/核心功能
- P1：重要改进，影响主路径体验
- P2：增强/工程化

---

## 待办清单（按优先级）

1. P0 渲染进程安全加固
   - 用户故事：作为用户，我希望应用更安全，避免恶意网页脚本造成风险。
   - 验收标准：`nodeIntegration=false`、`contextIsolation=true`；移除 `@electron/remote`；采用 `preload.js` 暴露受限 API；渲染进程不直接 `require('fs')/ffmpeg`。
   - 估时：3 天
   - 依赖：Electron 文档、重构 IPC 通道

2. P0 合法文件名与默认命名规则（Windows）
   - 用户故事：作为用户，我保存文件时应总能成功且默认文件名易读。
   - 验收标准：默认名 `screen-recording-YYYYMMDD-HHMMSS.mp4`；过滤 `\/:*?"<>|`；手动输入非法字符时给出提示。
   - 估时：0.5 天

3. P0 分段录制合并正确性
   - 用户故事：作为用户，我希望长时间录制能稳定生成可播放的完整文件。
   - 验收标准：使用 `mediaRecorder.start(timeslice)` 连续单会话采集，最终 Blob 无需外部“拼接”；或使用 FFmpeg concat 方案并通过 3 款播放器验证（Movies & TV/VLC/Edge）。
   - 估时：2 天

4. P1 编码与兼容性策略
   - 用户故事：作为用户，我希望不同设备都能录制成功，且文件体积可控。
   - 验收标准：优先 `video/webm;codecs=vp9|vp8`，不支持则降级；UI 展示编码/比特率提示；导出 MP4 路径可选质量预设（高/标准/小体积）。
   - 估时：2 天

5. P1 资源释放与大文件内存控制
   - 用户故事：作为用户，我不希望长时间录制导致应用卡顿或内存暴涨。
   - 验收标准：统一管理 ObjectURL 与 Blob 生命周期；完成保存/裁剪后 `URL.revokeObjectURL` 且释放旧 Blob；临时文件清理健壮。
   - 估时：1 天

6. P1 错误处理与可观测性
   - 用户故事：作为用户，我希望在失败时得到清晰可行的提示，并可选择保存原始文件。
   - 验收标准：对 `getUserMedia/MediaRecorder/FFmpeg` 的错误分类提示；失败兜底“保存原始 WebM”；可打开日志文件定位问题。
   - 估时：1 天

7. P1 音频选项增强（麦克风/系统/混音）
   - 用户故事：作为用户，我希望同时录制系统音与麦克风，并可选择其一或混音。
   - 验收标准：音轨选择 UI；双轨合并或并轨导出；无可用设备时的提示。
   - 估时：3 天

8. P2 工程化与测试
   - 用户故事：作为开发者，我希望提交代码能自动过基本质量检查并进行冒烟测试。
   - 验收标准：ESLint+Prettier；GitHub Actions 执行 Lint；添加一个最小 E2E 冒烟脚本（录制 5s、预览、导出、文件存在性校验）。
   - 估时：2 天

9. P2 文档与故障排查
   - 用户故事：作为用户/开发者，我希望快速自助排查常见问题。
   - 验收标准：README 补充“常见问题”与“已知限制”（驱动、权限、麦克风/系统音来源、显卡加速、打包后 ffmpeg 路径）。
   - 估时：0.5 天

10. P2 版本升级与打包验证
    - 用户故事：作为维护者，我希望 Electron 等依赖升级后仍能构建与运行。
    - 验收标准：升级至较新 Electron（如 30+）并通过打包版验证；`electron-builder` 配置校验（asarUnpack ffmpeg）。
    - 估时：2 天

---

## 里程碑建议
- M1（安全+稳定）：条目 1-3（1 周）
- M2（体验+兼容）：条目 4-7（1.5 周）
- M3（工程化）：条目 8-10（1 周）

## 指标与验收
- 录制成功率 > 98%（10 次脚本化冒烟中失败 ≤ 1 次）
- 导出失败率 < 2%
- 1 小时录制内存峰值 < 1.2x 基线（以 720p 测定）
- 主要流程崩溃率为 0（打包版）
